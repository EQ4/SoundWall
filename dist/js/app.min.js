/*
 soundwall 2014-05-03 
*/
$(function(){function a(){$(document).height($(window).height()),$("#grid").height($(document).height()-$("#header").height()),q=$("#grid").width()/m,r=$("#grid").height()/n,h()}function b(){console.log("building grid"),w=!1;var a=0,b=0,c=$("#grid");for(a=0;n>a;a++)for(b=0;m>b;b++){var d=$("<audio/>").attr("id","widget"+a+b),e=$("<img/>").attr("id","img"+a+b),f=$("<h2/>");d.attr("loop","true"),d.attr("controls","true"),d.attr("autoplay","true"),e.width(q),e.height(r),c.append(e),c.append(f),c.append(d),t.push(d)}h()}function c(){$("audio").remove(),$("img").remove(),$("h2").remove(),t=[],u=[],v=[]}function d(a){a.shiftKey&&76==a.which&&(w=!w)}function e(a){c(),b(),SC.get("/tracks",{q:a,limit:5*m*n},function(a){a.sort(function(){return.5-Math.random()}),s=a,f()})}function f(){l=Math.min(t.length,s.length);for(var a=0,b=0;l>a;){var c=s.pop();if(c.streamable===!0){console.log(c);var d=t[a];d.attr("src",c.stream_url+"?client_id="+k[a%2]),d[0].volume=0,d[0].play(),$(u[a]).append("<a href='"+c.permalink_url+"' target='_blank'>"+c.title+"</a>"),v[a].src=c.artwork_url?c.artwork_url.replace("large","t500x500"):"images/default.png",a++}b++}}function g(a,b){var c;if(0>a||0>b)for(c=0;c<t.length;c++)v[c].hasClass("active")&&(v[c].removeClass("active"),u.eq(c).removeClass("active"));else for(c=0;c<t.length;c++)c!=a*m+b&&(t[c][0].volume=0,v.eq(c).hasClass("active")&&(v.eq(c).removeClass("active"),u.eq(c).removeClass("active")))}function h(){u=$("h2"),v=$("img"),i=0,j=0,$("img").each(function(){$(this).width(q),$(this).height(r);var a=$(this).height(),b=$(this).position(),c=b.top,d=b.top+a-$(t[i]).height();$(u[i]).css({position:"absolute",top:c+"px",left:j*q+"px",width:q+"px"}),$(t[i]).css({position:"absolute",top:d+"px",left:j*q+"px",width:q+"px"}),i++,j++,j>=m&&(j=0)})}var k=["5371eb9743a8c619876d4e967d558f82","0dc8789a4e3488e1ba3d798f48b6a5e7"];SC.initialize({client_id:k[0]}),$(document).height($(window).height()),$("#grid").height($(document).height()-$("#header").height());var l,m=3,n=2,o=-1,p=-1,q=$("#grid").width()/m,r=$("#grid").height()/n,s=[],t=[],u=[],v=[],w=!1;$("#intro-modal").on("hide.bs.modal",function(){localStorage.setItem("intromodal",!0),e("armin van buuren")}),localStorage.getItem("intromodal")?e("armin van buuren"):$("#intro-modal").modal("show"),$(window).resize(function(){a()}),$(document).resize(function(){a()}),$("#searchterm").keypress(function(a){if(13==a.which){ga("send","event","input","search"),a.preventDefault();var b=$("#searchterm").val();e(b)}}),$(window).keypress(function(a){ga("send","event","input","locking"),d(a)}),$("#grid").mouseover(function(a){if(!w){ga("send","event","input","playtrack");var b=a.clientX,c=a.clientY-$("#search").height(),d=Math.max(Math.min(Math.floor(c/r),n-1),0),e=Math.min(Math.floor(b/q),m-1);console.log(d,e),$("#widget"+d+e)[0].volume=1,v.eq(d*m+e).addClass("active"),u.eq(d*m+e).addClass("active"),g(d,e),o=d,p=e}})});