/*
 soundwall 2014-05-02 
*/
$(function(){function a(){console.log("building grid"),v=!1;var a=0,b=0,c=$("#grid");for(a=0;m>a;a++)for(b=0;l>b;b++){var d=$("<audio/>").attr("id","widget"+a+b),e=$("<img/>").attr("id","img"+a+b),f=$("<h2/>");d.attr("loop","true"),d.attr("controls","true"),d.attr("autoplay","true"),e.width(p),e.height(q),c.append(e),c.append(f),c.append(d),s.push(d)}g()}function b(){$("audio").remove(),$("img").remove(),$("h2").remove(),s=[],t=[],u=[]}function c(a){a.shiftKey&&76==a.which&&(v=!v)}function d(c){b(),a(),SC.get("/tracks",{q:c,limit:5*l*m},function(a){a.sort(function(){return.5-Math.random()}),r=a,e()})}function e(){k=Math.min(s.length,r.length);for(var a=0,b=0;k>a;){var c=r.pop();if(c.streamable===!0){console.log(c);var d=s[a];d.attr("src",c.stream_url+"?client_id="+h[a%2]),d[0].volume=0,d[0].play(),$(t[a]).append("<a href='"+c.permalink_url+"' target='_blank'>"+c.title+"</a>"),u[a].src=c.artwork_url?c.artwork_url.replace("large","t500x500"):"images/default.png",a++}b++}}function f(a,b){var c;if(0>a||0>b)for(c=0;c<s.length;c++)u[c].hasClass("active")&&(u[c].removeClass("active"),t.eq(c).removeClass("active"));else for(c=0;c<s.length;c++)c!=a*l+b&&(s[c][0].volume=0,u.eq(c).hasClass("active")&&(u.eq(c).removeClass("active"),t.eq(c).removeClass("active")))}function g(){t=$("h2"),u=$("img"),i=0,j=0,$("img").each(function(){$(this).width(p),$(this).height(q);var a=$(this).height(),b=$(this).position(),c=b.top,d=b.top+a-$(s[i]).height();$(t[i]).css({position:"absolute",top:c+"px",left:j*p+"px",width:p+"px"}),$(s[i]).css({position:"absolute",top:d+"px",left:j*p+"px",width:p+"px"}),i++,j++,j>=l&&(j=0)})}var h=["5371eb9743a8c619876d4e967d558f82","0dc8789a4e3488e1ba3d798f48b6a5e7"];SC.initialize({client_id:h[0]}),$(document).height($(window).height()),$("#grid").height($(document).height()-$("#header").height());var k,l=3,m=2,n=-1,o=-1,p=$("#grid").width()/l,q=$("#grid").height()/m,r=[],s=[],t=[],u=[],v=!1;$("#intro-modal").on("hide.bs.modal",function(){localStorage.setItem("intromodal",!0),d("armin van buuren")}),localStorage.getItem("intromodal")?d("armin van buuren"):$("#intro-modal").modal("show"),$(window).resize(function(){p=$("#grid").width()/l,q=$("#grid").height()/m,g()}),$("#searchterm").keypress(function(a){if(13==a.which){ga("send","event","input","search"),a.preventDefault();var b=$("#searchterm").val();d(b)}}),$(window).keypress(function(a){ga("send","event","input","locking"),c(a)}),$("#grid").mouseover(function(a){if(!v){ga("send","event","input","playtrack");var b=a.clientX,c=a.clientY-$("#search").height(),d=Math.max(Math.min(Math.floor(c/q),m-1),0),e=Math.min(Math.floor(b/p),l-1);console.log(d,e),$("#widget"+d+e)[0].volume=1,u.eq(d*l+e).addClass("active"),t.eq(d*l+e).addClass("active"),f(d,e),n=d,o=e}})});