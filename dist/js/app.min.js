/*
 soundwall 2014-05-01 
*/
$(function(){function a(){console.log("building grid"),u=!1;var a=0,b=0,c=$("#grid");for(a=0;m>a;a++)for(b=0;l>b;b++){var d=$("<audio/>").attr("id","widget"+a+b),e=$("<img/>").attr("id","img"+a+b),f=$("<h2/>");d.attr("loop","true"),d.attr("controls","true"),d.attr("autoplay","true"),e.width(p),e.height(q),c.append(e),c.append(f),c.append(d),r.push(d)}g()}function b(){$("audio").remove(),$("img").remove(),$("h2").remove(),r=[],s=[],t=[]}function c(a){a.shiftKey&&76==a.which&&(u=!u)}function d(c){b(),a(),SC.get("/tracks",{q:c,limit:5*l*m},function(a){a.sort(function(){return.5-Math.random()}),e(a)})}function e(a){k=Math.min(r.length,a.length);var b=0,c=0;for(console.log(a);k>b;){var d=a[c];if(d.streamable===!0){console.log("added=",b,"title=",d.title),console.log(d);var e=r[b];e.attr("src",d.stream_url+"?client_id="+h[b%2]),e[0].volume=0,e[0].play(),$(s[b]).text(d.title),t[b].src=d.artwork_url?d.artwork_url.replace("large","t500x500"):"images/default.png",console.log(b),b++}c++}}function f(a,b){var c;if(0>a||0>b)for(c=0;c<r.length;c++)t[c].hasClass("active")&&(t[c].removeClass("active"),s.eq(c).removeClass("active"));else for(c=0;c<r.length;c++)c!=a*l+b&&(r[c][0].volume=0,t.eq(c).hasClass("active")&&(t.eq(c).removeClass("active"),s.eq(c).removeClass("active")))}function g(){s=$("h2"),t=$("img"),i=0,j=0,$("img").each(function(){$(this).width(p),$(this).height(q);var a=$(this).height(),b=$(this).position(),c=b.top,d=b.top+a-$(r[i]).height();$(s[i]).css({position:"absolute",top:c+"px",left:j*p+"px",width:p+"px"}),$(r[i]).css({position:"absolute",top:d+"px",left:j*p+"px",width:p+"px"}),i++,j++,j>=l&&(j=0)})}var h=["5371eb9743a8c619876d4e967d558f82","0dc8789a4e3488e1ba3d798f48b6a5e7"];SC.initialize({client_id:h[0]}),$(document).height($(window).height()),$("#grid").height($(document).height()-$("#header").height());var k,l=3,m=2,n=-1,o=-1,p=$("#grid").width()/l,q=$("#grid").height()/m,r=[],s=[],t=[],u=!1;$("#intro-modal").on("hide.bs.modal",function(){localStorage.setItem("intromodal",!0),d("armin van buuren")}),localStorage.getItem("intromodal")?d("armin van buuren"):$("#intro-modal").modal("show"),$(window).resize(function(){p=$("#grid").width()/l,q=$("#grid").height()/m,g()}),$("#searchterm").keypress(function(a){if(13==a.which){ga("send","event","input","search"),a.preventDefault();var b=$("#searchterm").val();d(b)}}),$(window).keypress(function(a){ga("send","event","input","locking"),c(a)}),$("#grid").mouseover(function(a){if(!u){ga("send","event","input","playtrack");var b=a.clientX,c=a.clientY-$("#search").height(),d=Math.max(Math.min(Math.floor(c/q),m-1),0),e=Math.min(Math.floor(b/p),l-1);console.log(d,e),$("#widget"+d+e)[0].volume=1,t.eq(d*l+e).addClass("active"),s.eq(d*l+e).addClass("active"),f(d,e),n=d,o=e}})});